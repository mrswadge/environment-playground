# Docker Compose for Java 21 Development Environment
# Includes Eclipse Temurin JDK 21
# Note: For Maven/Gradle, install them in the container or use multi-stage builds

services:
  java21-dev:
    image: eclipse-temurin:21-jdk
    container_name: java21-dev
    hostname: java21-dev
    volumes:
      - ./projects:/home/app/projects
      - maven-cache:/root/.m2
      - gradle-cache:/root/.gradle
    working_dir: /home/app/projects
    ports:
      - "8080:8080"
      - "8443:8443"
    environment:
      - JAVA_HOME=/opt/java/openjdk
    command: tail -f /dev/null  # Keep container running for development
    restart: unless-stopped

  # Java 21 with Maven and Gradle pre-installed
  java21-full:
    build:
      context: .
      dockerfile_inline: |
        FROM eclipse-temurin:21-jdk
        RUN apt-get update && apt-get install -y wget unzip \
            && wget -q https://archive.apache.org/dist/maven/maven-3/3.9.6/binaries/apache-maven-3.9.6-bin.tar.gz \
            && tar xzf apache-maven-3.9.6-bin.tar.gz -C /opt \
            && ln -s /opt/apache-maven-3.9.6 /opt/maven \
            && wget -q https://services.gradle.org/distributions/gradle-8.5-bin.zip \
            && unzip -q gradle-8.5-bin.zip -d /opt \
            && ln -s /opt/gradle-8.5 /opt/gradle \
            && rm -rf apache-maven-3.9.6-bin.tar.gz gradle-8.5-bin.zip \
            && apt-get clean
        ENV MAVEN_HOME=/opt/maven
        ENV GRADLE_HOME=/opt/gradle
        ENV PATH=$MAVEN_HOME/bin:$GRADLE_HOME/bin:$PATH
    container_name: java21-full-dev
    hostname: java21-full-dev
    volumes:
      - ./projects:/home/app/projects
      - maven-cache:/root/.m2
      - gradle-cache:/root/.gradle
    working_dir: /home/app/projects
    ports:
      - "8081:8080"
      - "8444:8443"
    command: tail -f /dev/null
    restart: unless-stopped

volumes:
  maven-cache:
  gradle-cache:
